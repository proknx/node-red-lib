[
    {
        "id": "ef7e3d81.08b63",
        "type": "comment",
        "z": "72a1c1.33ab1e4",
        "name": "======= KNX COMMUNICATION MODULE ========",
        "info": "# Exemple implementation of the Gateway Communication Module.\nThere are two parts, hence two handlers\n 1. Generic Query - to GET the value\n 2. Generic Command - absolute SET and realtive SET value (increase/decrease)\n\n## Generic Query\nThis handler is called when the Snips application needs to get the current value of a device (temperature, brightness, shutters position, sensors etc)\nIt receives an array of commands.\n\n# Generic command\nThis handler is called to get the current value of the device (on,off,decrease,set etc)\nThe link in node of the generic command is also connected to Snips application. It receive \ncommands of devices as input. It could be one command or an array of commands at a time.\n\n# Return\ntrue is when the server repond correctly, otherwise, Result is false ",
        "x": 1360,
        "y": 380,
        "wires": []
    },
    {
        "id": "65cdb39c.4fceac",
        "type": "comment",
        "z": "72a1c1.33ab1e4",
        "name": "GATEWAY DESCRIPTION FILE",
        "info": "",
        "x": 1290,
        "y": 283,
        "wires": []
    },
    {
        "id": "b71223fd.a0daa",
        "type": "function",
        "z": "72a1c1.33ab1e4",
        "name": "Respose",
        "func": "//From the server respond, put it in this format\n//For more than one devices\n//\n//\n        // [{\n        //     \"Data\" : [{            \n        //         \"Value\" : 100,\n        //         \"uid\" : \"\" \n        //     }],\n        //     \"Result\":true\n        // },\n        // {\n        //     \"Data\" : [{            \n        //         \"Value\" : 50,\n        //         \"type\" : \"\"\n        //     }],\n        //     \"Result\":true\n        // }] \n        \nmsg.states = [];\nfor(var i = 0 ; i < msg.payload.length ; i++){\n        msg.states[i] = { \n            \"Data\" : [{\n                \"Value\" : msg.payload[i]\n            }]\n        };\n        if(msg.states[i].Data[0].Value !== undefined){\n            msg.states[i].Result=true;\n        }else{\n            msg.states[i].Result=false;\n        }\n}\n\nmsg.payload=msg.states;\ndelete msg.states;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1980,
        "y": 480,
        "wires": [
            [
                "5c6fa84f.1a1118"
            ]
        ]
    },
    {
        "id": "22ac0f91.533598",
        "type": "function",
        "z": "72a1c1.33ab1e4",
        "name": "Response",
        "func": "msg.payload = [];\nmsg.payload[0] = {\"Result\" : true};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1690,
        "y": 580,
        "wires": [
            [
                "b4ccb159.a5485"
            ]
        ]
    },
    {
        "id": "6993737b.062acc",
        "type": "knxUltimate",
        "z": "72a1c1.33ab1e4",
        "server": "c20db14e.e29ce",
        "topic": "",
        "dpt": "1.001",
        "initialread": false,
        "notifyreadrequest": false,
        "notifyresponse": false,
        "notifywrite": false,
        "notifyreadrequestalsorespondtobus": false,
        "notifyreadrequestalsorespondtobusdefaultvalueifnotinitialized": "0",
        "listenallga": true,
        "name": "knx",
        "outputtype": "write",
        "outputRBE": false,
        "inputRBE": false,
        "x": 1650,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "113a4cc6.ff8913",
        "type": "inject",
        "z": "72a1c1.33ab1e4",
        "name": "Inject description file - raw KNX",
        "topic": "",
        "payload": "{\"functions\":[{\"displayName\":\"Ceiling\",\"functionType\":\"lights\",\"zone\":\"Bedroom\",\"commands\":[{\"name\":\"On\",\"destination\":\"0/0/6\",\"dpt\":\"1.001\",\"value\":1},{\"name\":\"Off\",\"destination\":\"0/0/6\",\"dpt\":\"1.001\",\"value\":0}],\"currentStates\":[{\"name\":\"CurrentState\",\"dpt\":\"1.001\",\"destination\":\"0/1/6\",\"valueMin\":0,\"valueMax\":1}]},{\"displayName\":\"Ceiling\",\"functionType\":\"dimmers\",\"zone\":\"Home Cinema\",\"commands\":[{\"name\":\"On\",\"destination\":\"0/3/1\",\"dpt\":\"5.001\",\"value\":100},{\"name\":\"Off\",\"destination\":\"0/3/1\",\"dpt\":\"5.001\",\"value\":0},{\"name\":\"Brightness\",\"destination\":\"0/3/1\",\"dpt\":\"5.001\",\"valueMin\":0,\"valueMax\":100}],\"currentStates\":[{\"name\":\"CurrentBrightness\",\"dpt\":\"5.001\",\"destination\":\"0/4/1\",\"valueMin\":0,\"valueMax\":100}]},{\"displayName\":\"Table\",\"functionType\":\"lights\",\"zone\":\"Home Cinema\",\"commands\":[{\"name\":\"On\",\"destination\":\"0/0/7\",\"dpt\":\"1.001\",\"value\":1},{\"name\":\"Off\",\"destination\":\"0/0/7\",\"dpt\":\"1.001\",\"value\":0}],\"currentStates\":[{\"name\":\"CurrentState\",\"destination\":\"0/1/7\",\"dpt\":\"1.001\",\"valueMin\":0,\"valueMax\":1}]},{\"displayName\":\"Shutter\",\"functionType\":\"blinds\",\"zone\":\"Home Cinema\",\"commands\":[{\"name\":\"On\",\"destination\":\"1/3/1\",\"dpt\":\"5.001\",\"value\":0},{\"name\":\"Off\",\"destination\":\"1/3/1\",\"dpt\":\"5.001\",\"value\":255},{\"name\":\"Position\",\"destination\":\"1/3/1\",\"dpt\":\"5.001\",\"valueMin\":0,\"valueMax\":255}],\"currentStates\":[{\"name\":\"CurrentPosition\",\"destination\":\"1/4/1\",\"dpt\":\"5.001\",\"valueMin\":0,\"valueMax\":255}]},{\"displayName\":\"Cinema\",\"functionType\":\"heating\",\"zone\":\"Home Cinema\",\"commands\":[{\"name\":\"TargetTemperature\",\"destination\":\"4/1/0\",\"dpt\":\"9.001\",\"valueMin\":18,\"valueMax\":28}],\"currentStates\":[{\"name\":\"TargetTemperature\",\"destination\":\"4/1/1\",\"dpt\":\"9.001\",\"valueMin\":18,\"valueMax\":28},{\"name\":\"CurrentTemperature\",\"destination\":\"4/1/2\",\"dpt\":\"9.001\",\"valueMin\":18,\"valueMax\":28}]},{\"displayName\":\"Cosy\",\"functionType\":\"scenes\",\"zone\":\"Home Cinema\",\"commands\":[{\"name\":\"On\",\"destination\":\"2/5/0\",\"dpt\":\"18.001\",\"value\":1}]},{\"displayName\":\"Total Power\",\"functionType\":\"sensor\",\"zone\":\"Home Cinema\",\"unit\":\"Watt\",\"currentStates\":[{\"name\":\"CurrentValue\",\"destination\":\"9/1/1\",\"dpt\":\"9.024\"}]},{\"displayName\":\"Speaker\",\"functionType\":\"aux\",\"zone\":\"Bedroom\",\"commands\":[{\"name\":\"On\",\"destination\":\"10/4/4\",\"dpt\":\"5.001\",\"value\":50},{\"name\":\"Off\",\"destination\":\"10/4/4\",\"dpt\":\"5.001\",\"value\":0},{\"name\":\"Value\",\"destination\":\"10/4/4\",\"dpt\":\"5.001\",\"valueMin\":0,\"valueMax\":255}],\"currentStates\":[{\"name\":\"CurrentValue\",\"destination\":\"10/4/3\",\"dpt\":\"5.001\",\"valueMin\":0,\"valueMax\":255}]}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 1310,
        "y": 320,
        "wires": [
            [
                "2ec856b2.3fa17a"
            ]
        ]
    },
    {
        "id": "e4cc57fc.04f6e8",
        "type": "change",
        "z": "72a1c1.33ab1e4",
        "name": "prep",
        "rules": [
            {
                "t": "set",
                "p": "dpt",
                "pt": "msg",
                "to": "payload.dpt",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "destination",
                "pt": "msg",
                "to": "payload.destination",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 600,
        "wires": [
            [
                "6993737b.062acc",
                "22ac0f91.533598"
            ]
        ]
    },
    {
        "id": "5f20ba11.45287c",
        "type": "function",
        "z": "72a1c1.33ab1e4",
        "name": "Write",
        "func": "msg.device = msg.payload;\nmsg.payload =[];\nfor(var i = 0; i < msg.device.length ; i++){\n    msg.payload[i] ={\n        \"destination\": msg.device[i].destination,\n        \"dpt\": msg.device[i].dpt,\n        \"value\": msg.device[i].value\n    };\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1270,
        "y": 600,
        "wires": [
            [
                "79333db1.880da4"
            ]
        ]
    },
    {
        "id": "79333db1.880da4",
        "type": "split",
        "z": "72a1c1.33ab1e4",
        "name": "split",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1390,
        "y": 600,
        "wires": [
            [
                "e4cc57fc.04f6e8"
            ]
        ]
    },
    {
        "id": "1c044177.eb9397",
        "type": "knxUltimate",
        "z": "72a1c1.33ab1e4",
        "server": "c20db14e.e29ce",
        "topic": "",
        "dpt": "1.001",
        "initialread": false,
        "notifyreadrequest": false,
        "notifyresponse": true,
        "notifywrite": false,
        "notifyreadrequestalsorespondtobus": false,
        "notifyreadrequestalsorespondtobusdefaultvalueifnotinitialized": "0",
        "listenallga": true,
        "name": "knx",
        "outputtype": "write",
        "outputRBE": false,
        "inputRBE": false,
        "x": 1490,
        "y": 520,
        "wires": [
            [
                "7ac1fcb5.248814"
            ]
        ]
    },
    {
        "id": "8e2cdebc.a616",
        "type": "change",
        "z": "72a1c1.33ab1e4",
        "name": " prep",
        "rules": [
            {
                "t": "set",
                "p": "dpt",
                "pt": "msg",
                "to": "payload.dpt",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "destination",
                "pt": "msg",
                "to": "payload.destination",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "readstatus",
                "pt": "msg",
                "to": "payload.readstatus",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1370,
        "y": 500,
        "wires": [
            [
                "1c044177.eb9397",
                "fc784f62.8f05c8"
            ]
        ]
    },
    {
        "id": "977c95ec.fe0ba8",
        "type": "function",
        "z": "72a1c1.33ab1e4",
        "name": "Query",
        "func": "msg.device = msg.payload;\nmsg.payload = [];\nfor(var i = 0; i < msg.device.length ; i++){\n    msg.payload[i] ={\n        \"destination\": msg.device[i].destination,\n        \"dpt\": msg.device[i].dpt,\n        \"readstatus\" : true\n    };\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1270,
        "y": 440,
        "wires": [
            [
                "7f182862.005a18"
            ]
        ]
    },
    {
        "id": "7f182862.005a18",
        "type": "split",
        "z": "72a1c1.33ab1e4",
        "name": "split",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1390,
        "y": 420,
        "wires": [
            [
                "8e2cdebc.a616"
            ]
        ]
    },
    {
        "id": "f8b5428d.4c619",
        "type": "join",
        "z": "72a1c1.33ab1e4",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1890,
        "y": 440,
        "wires": [
            [
                "b71223fd.a0daa"
            ]
        ]
    },
    {
        "id": "ab02b9d6.208b78",
        "type": "join-wait",
        "z": "72a1c1.33ab1e4",
        "name": "",
        "paths": "[\"path_1\", \"path_2\"]",
        "pathsToExpire": "",
        "ignoreUnmatched": true,
        "pathTopic": "paths",
        "pathTopicType": "msg",
        "correlationTopic": "correlation",
        "correlationTopicType": "msg",
        "timeout": "2000",
        "timeoutUnits": 1,
        "exactOrder": "false",
        "firstMsg": "true",
        "mapPayload": "true",
        "disableComplete": false,
        "x": 1680,
        "y": 440,
        "wires": [
            [
                "1fdc2e0d.1a5652"
            ],
            []
        ]
    },
    {
        "id": "7ac1fcb5.248814",
        "type": "change",
        "z": "72a1c1.33ab1e4",
        "name": "path_2",
        "rules": [
            {
                "t": "set",
                "p": "paths",
                "pt": "msg",
                "to": "path_2",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "correlation",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "result",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 520,
        "wires": [
            [
                "ab02b9d6.208b78"
            ]
        ]
    },
    {
        "id": "fc784f62.8f05c8",
        "type": "change",
        "z": "72a1c1.33ab1e4",
        "name": "path_1",
        "rules": [
            {
                "t": "set",
                "p": "paths",
                "pt": "msg",
                "to": "path_1",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "correlation",
                "pt": "msg",
                "to": "destination",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1500,
        "y": 480,
        "wires": [
            [
                "ab02b9d6.208b78"
            ]
        ]
    },
    {
        "id": "1fdc2e0d.1a5652",
        "type": "change",
        "z": "72a1c1.33ab1e4",
        "name": "result",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "paths.path_2",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "paths",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "correlation",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "readstatus",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "dpt",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "destination",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1790,
        "y": 480,
        "wires": [
            [
                "f8b5428d.4c619"
            ]
        ]
    },
    {
        "id": "c20db14e.e29ce",
        "type": "knxUltimate-config",
        "z": "",
        "host": "",
        "port": "3671",
        "physAddr": "",
        "suppressACKRequest": false,
        "csv": "",
        "KNXEthInterface": "Auto",
        "KNXEthInterfaceManuallyInput": "",
        "statusDisplayLastUpdate": true,
        "statusDisplayDeviceNameWhenALL": true,
        "statusDisplayDataPoint": false,
        "stopETSImportIfNoDatapoint": "stop"
    }
]
